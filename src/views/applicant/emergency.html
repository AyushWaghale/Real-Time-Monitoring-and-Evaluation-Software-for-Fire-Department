<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emergency NOC Application Form</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="bg-gray-100 py-10">
    <div class="max-w-4xl mx-auto bg-white shadow-lg rounded-lg p-8">
        <h1 class="text-2xl font-bold mb-6 text-gray-800 text-center">Emergency NOC Application Form</h1>
        <form id="emergencyForm" action="#" method="POST" enctype="multipart/form-data">
            <!-- Applicant Information -->
            <h2 class="text-lg font-semibold text-gray-700 mb-4">Applicant Information</h2>

            <div class="mb-4">
                <label for="fullName" class="block text-gray-600 mb-2">
                    <i class="fas fa-user mr-2"></i> Full Name
                </label>
                <input type="text" id="fullName" name="fullName" class="w-full border border-gray-300 rounded-lg p-2 focus:ring focus:ring-indigo-200" placeholder="Enter your full name" required>
            </div>

            <div class="mb-4">
                <label for="contactNumber" class="block text-gray-600 mb-2">
                    <i class="fas fa-phone mr-2"></i> Contact Number
                </label>
                <input type="text" id="contactNumber" name="contactNumber" class="w-full border border-gray-300 rounded-lg p-2 focus:ring focus:ring-indigo-200" placeholder="Enter your contact number" required>
            </div>

            <div class="mb-4">
                <label for="email" class="block text-gray-600 mb-2">
                    <i class="fas fa-envelope mr-2"></i> Email Address
                </label>
                <input type="email" id="email" name="email" class="w-full border border-gray-300 rounded-lg p-2 focus:ring focus:ring-indigo-200" placeholder="Enter your email" required>
            </div>

            <div class="mb-4">
                <label for="address" class="block text-gray-600 mb-2">
                    <i class="fas fa-home mr-2"></i> Address
                </label>
                <textarea id="address" name="address" class="w-full border border-gray-300 rounded-lg p-2 focus:ring focus:ring-indigo-200" rows="3" placeholder="Enter your address" required></textarea>
            </div>

            <!-- NOC Details -->
            <h2 class="text-lg font-semibold text-gray-700 mb-4">NOC Details</h2>

            <div class="mb-4">
                <label for="reason" class="block text-gray-600 mb-2">
                    <i class="fas fa-info-circle mr-2"></i> Reason for NOC Request
                </label>
                <textarea id="reason" name="reason" class="w-full border border-gray-300 rounded-lg p-2 focus:ring focus:ring-indigo-200" rows="3" placeholder="Describe the reason"></textarea>
            </div>

            <div class="mb-4">
                <label for="purpose" class="block text-gray-600 mb-2">
                    <i class="fas fa-briefcase mr-2"></i> Purpose of NOC
                </label>
                <select id="purpose" name="purpose" class="w-full border border-gray-300 rounded-lg p-2 focus:ring focus:ring-indigo-200">
                    <option value="Travel">Travel</option>
                    <option value="Job">Job</option>
                    <option value="Other">Other</option>
                </select>
            </div>

            <div class="mb-4">
                <label for="requiredBy" class="block text-gray-600 mb-2">
                    <i class="fas fa-calendar-alt mr-2"></i> Required By (Date)
                </label>
                <input type="date" id="requiredBy" name="requiredBy" class="w-full border border-gray-300 rounded-lg p-2 focus:ring focus:ring-indigo-200" required>
            </div>

            <!-- Emergency Justification -->
            <h2 class="text-lg font-semibold text-gray-700 mb-4">Emergency Justification</h2>

            <div class="mb-4">
                <label for="emergency" class="block text-gray-600 mb-2">
                    <i class="fas fa-exclamation-circle mr-2"></i> Explanation of Emergency
                </label>
                <textarea id="emergency" name="emergency" class="w-full border border-gray-300 rounded-lg p-2 focus:ring focus:ring-indigo-200" rows="3" placeholder="Explain the emergency in detail"></textarea>
            </div>

            <!-- Declaration -->
            <h2 class="text-lg font-semibold text-gray-700 mb-4">Declaration</h2>

            <div class="mb-4">
                <p class="text-gray-600">
                    I hereby declare that the information provided above is true and accurate to the best of my knowledge.
                </p>
            </div>

            <div class="mb-4">
                <label for="applicantName" class="block text-gray-600 mb-2">
                    <i class="fas fa-signature mr-2"></i> Applicant's Name
                </label>
                <input type="text" id="applicantName" name="applicantName" class="w-full border border-gray-300 rounded-lg p-2 focus:ring focus:ring-indigo-200" placeholder="Enter your name" required>
            </div>

            <div class="mb-4">
                <label for="signature" class="block text-gray-600 mb-2">
                    <i class="fas fa-pen-nib mr-2"></i> Signature
                </label>
                <input type="text" id="signature" name="signature" class="w-full border border-gray-300 rounded-lg p-2 focus:ring focus:ring-indigo-200" placeholder="Enter your signature" required>
            </div>

            <div class="mb-4">
                <label for="submissionDate" class="block text-gray-600 mb-2">
                    <i class="fas fa-calendar-day mr-2"></i> Date of Submission
                </label>
                <input type="date" id="submissionDate" name="submissionDate" class="w-full border border-gray-300 rounded-lg p-2 focus:ring focus:ring-indigo-200" required>
            </div>

            <button type="submit" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700">
                Submit Application
            </button>
        </form>
    </div>

    <script>
        document.getElementById('emergencyForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            // Get form data
            const formData = {
                fullName: document.getElementById('fullName').value,
                contactNumber: document.getElementById('contactNumber').value,
                email: document.getElementById('email').value,
                address: document.getElementById('address').value,
                reason: document.getElementById('reason').value,
                purpose: document.getElementById('purpose').value,
                requiredBy: document.getElementById('requiredBy').value,
                emergency: document.getElementById('emergency').value,
                applicantName: document.getElementById('applicantName').value,
                signature: document.getElementById('signature').value,
                submissionDate: document.getElementById('submissionDate').value
            };

            try {
                // Get the authentication token from localStorage
                const token = localStorage.getItem('token');
                if (!token) {
                    throw new Error('No authentication token found');
                }

                // Submit the form data to the server
                const response = await fetch('https://realtime-nv23.onrender.com/api/noc-application/emergency-application', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (response.ok) {
                    // Show success message
                    alert(`Emergency NOC Application submitted successfully! Application ID: ${result.applicationId}`);
                    // Optionally redirect or reset form
                    this.reset();
                } else {
                    // Show error message
                    alert(`Error: ${result.message}`);
                }
            } catch (error) {
                console.error('Submission error:', error);
                alert('An error occurred while submitting the application');
            }
        });
    </script>
</body>
</html>
